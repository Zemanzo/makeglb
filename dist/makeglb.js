!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MakeGLB",[],t):"object"==typeof exports?exports.MakeGLB=t():e.MakeGLB=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r={"image/png":["png"],"image/jpeg":["jpg","jpeg"],"text/plain":["glsl","vert","vs","frag","fs","txt"],"image/vnd-ms.dds":["dds"]},o=(e,t)=>{let n=0;if(e>0){const r=e%t;n=e+(0===r?0:t-r)}return n},f=async(e,t)=>{let n=0;const f={},i=(e=>{const t=[];return e.buffers.forEach(e=>{const{uri:n}=e;t.push({type:"buffer",uri:n})}),e.images&&e.images.forEach(e=>{const{uri:n}=e;t.push({type:"image",uri:n})}),t})(e),s=await(async(e,t)=>{const n=e.map(e=>{const{uri:n}=e;return new Promise(async e=>{if(t){const r=n.split("/"),o=r[r.length-1].toLowerCase();e(t[o])}else{const t=await fetch(n);e(await t.arrayBuffer())}})});return new Promise(t=>{Promise.all(n).then(n=>{const r=e.map((e,t)=>{const{type:r}=e;return{index:t,type:r,data:n[t]}});t(r)})})})(i,t);return e.buffers.map((e,t)=>{delete e.uri,e.byteLength=s[t].data.byteLength,f[t]=n,n+=o(s[t].data.byteLength,4)}),e.images&&e.images.map((t,i)=>{const u=e.buffers.length+i;f[u]=n;const a={buffer:0,byteOffset:n,byteLength:s[u].data.byteLength};n+=o(s[u].data.byteLength,4);const c=e.bufferViews.length;e.bufferViews.push(a),t.bufferView=c,t.mimeType=(e=>{const t=Object.keys(r);for(let n=0;n<t.length;++n){const o=t[n];for(let t=0;t<r[o].length;++t){const n=r[o][t];if(e.toLowerCase().indexOf(n)>0)return o}}return"application/octet-stream"})(t.uri),delete t.uri}),{bufferMap:f,bufferSize:n,buffers:s}},i=async(e,t)=>{const n=JSON.parse(JSON.stringify(e)),{bufferMap:r,bufferSize:i,buffers:s}=await f(n,t);n.buffers=[{byteLength:i}];const u=(new TextEncoder).encode(JSON.stringify(n)),a=o(u.length,4),c=a-u.length,l=20+a+8+i,p=new ArrayBuffer(l),d=new DataView(p);let b=0;d.setUint32(b,1179937895,!0),b+=4,d.setUint32(b,2,!0),b+=4,d.setUint32(b,l,!0),b+=4,d.setUint32(b,a,!0),b+=4,d.setUint32(b,1313821514,!0),b+=4;for(let e=0;e<u.length;++e)d.setUint8(b,u[e]),b+=1;for(let e=0;e<c;++e)d.setUint8(b,32),b+=1;d.setUint32(b,i,!0),b+=4,d.setUint32(b,5130562,!0),b+=4;for(let e=0;e<s.length;++e){const t=b+r[e],n=new Uint8Array(s[e].data);for(let r=0;r<s[e].data.byteLength;++r)d.setUint8(t+r,n[r])}return p},s=e=>new Blob([e],{type:"model/json-binary"});n.d(t,"GLBfromGLTF",function(){return i}),n.d(t,"BLOBfromGLB",function(){return s})}])});